---
title: "10:30:20 AM - October 16, 2025"
date: 2025-10-15T21:30:20.043Z
timestamp: 1760563820043
---

## Project Notes

PR8 Router Migration Progress (2025-10-16):

**Completed:**
1. Created feature/router-full-migration branch
2. Updated main.dart to MaterialApp.router with routeNormalizationProvider active
3. Rewrote app_router.dart with ShellRoute for per-tab state preservation
4. Created app_shell.dart with URL-driven bottom navigation
5. Deleted MainNavigationScreen (403 lines removed)
6. Fixed universal_camera_screen_pure.dart to use context.go() instead of mainNavigationKey
7. Fixed app_router.dart: removed incorrect parentNavigatorKey from ShellRoute children
8. Created app_shell_integration_test.dart with 9 tests (4 passing, 5 failing due to service dependencies)

**Key Technical Learnings:**
- ShellRoute child routes MUST NOT have parentNavigatorKey - they're meant to render within the shell
- parentNavigatorKey is only for bypassing the shell to render in a parent navigator
- GoRouter assertion error: "sub-route's parent navigator key must either be null or has the same navigator key as parent's key"

**Remaining Work (PR8.7):**
6 files still reference deleted mainNavigationKey:
1. lib/screens/activity_screen.dart:286
2. lib/screens/explore_screen.dart:720-721 (MainNavigationScreenState type refs)
3. lib/screens/video_feed_screen.dart:508
4. lib/widgets/clickable_hashtag_text.dart:117
5. lib/widgets/video_explore_tile.dart:149
6. lib/widgets/video_feed_item.dart:539

Plus test files: test/utils/feed_navigation_test.dart needs MainNavigationScreen refs removed

**Test Status:**
- app_shell_integration_test.dart: 4/9 tests passing
- Failures are service dependency issues (NostrService, timers, profile providers)
- Core routing is working correctly

**Architecture:**
Router is now fully URL-driven:
- ShellRoute preserves per-tab navigator state
- Bottom nav reflects URL, taps navigate to canonical paths
- Route normalization active at app root
- Camera screen uses context.go('/profile/me/0') after recording
